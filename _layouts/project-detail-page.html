---
layout: default
---

{% if page.images %}
<section class="project-media-section">
  <div class="image-viewer">
    <div class="image-viewer-main">
      <button
        type="button"
        class="image-viewer-arrow image-viewer-arrow--prev"
        aria-label="Previous image"
      >
        <span class="image-viewer-arrow-icon">&#8249;</span>
      </button>

      <div class="image-viewer-track">
        {% for image in page.images %}
          <div class="image-slide" data-index="{{ forloop.index0 }}">
            <img
              src="{{ site.baseurl }}{{ page.dir }}{{ image.src }}"
              alt="{{ image.caption | default: page.title | escape }}"
              {% unless forloop.first %}loading="lazy"{% endunless %}
            >
          </div>
        {% endfor %}
      </div>

      <button
        type="button"
        class="image-viewer-arrow image-viewer-arrow--next"
        aria-label="Next image"
      >
        <span class="image-viewer-arrow-icon">&#8250;</span>
      </button>
    </div>

    <div class="image-viewer-thumbnails">
      {% for image in page.images %}
        <button
          type="button"
          class="image-viewer-thumb{% if forloop.first %} image-viewer-thumb--active{% endif %}"
          data-index="{{ forloop.index0 }}"
          aria-label="View image {{ forloop.index }}"
        >
          <img
            src="{{ site.baseurl }}{{ page.dir }}{{ image.src }}"
            alt="{{ image.caption | default: page.title | escape }}"
            {% unless forloop.first %}loading="lazy"{% endunless %}
          >
        </button>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<section class="project-detail">
  <div class="project-layout">
    <section class="model-viewer-panel">
      <h2 class="model-viewer-title">Interactive 3D model</h2>
      <model-viewer
        src="{{ site.baseurl }}{{ page.dir }}{{ page.model_src }}"
        camera-controls
        {% if page.model_camera_orbit %}camera-orbit="{{ page.model_camera_orbit }}"{% endif %}
        {% if page.model_camera_target %}camera-target="{{ page.model_camera_target }}"{% endif %}
        {% if page.model_fov %}field-of-view="{{ page.model_fov }}"{% endif %}
      >
      </model-viewer>
    </section>

    <div class="project-main-column">
      <h1 class="project-title">
        {{ page.title }}
      </h1>

      {% if page.summary %}
        <p class="project-summary">
          {{ page.summary }}
        </p>
      {% endif %}

      <div class="project-content-section">
        {{ content }}
      </div>
    </div>

    <aside class="project-aside-column">
      <!-- Reserved for secondary narrative content if needed in future iterations -->
    </aside>
  </div>
</section>

{% if page.images %}
<script>
  (function () {
    var viewer = document.querySelector('.image-viewer');
    if (!viewer) return;

    var track = viewer.querySelector('.image-viewer-track');
    var slides = Array.prototype.slice.call(track.querySelectorAll('.image-slide'));
    var thumbs = Array.prototype.slice.call(viewer.querySelectorAll('.image-viewer-thumb'));
    var prevButton = viewer.querySelector('.image-viewer-arrow--prev');
    var nextButton = viewer.querySelector('.image-viewer-arrow--next');
    var currentIndex = 0;

    if (!slides.length) return;

    function setActive(index) {
      currentIndex = (index + slides.length) % slides.length;
      var targetSlide = slides[currentIndex];

      if (targetSlide && targetSlide.scrollIntoView) {
        targetSlide.scrollIntoView({
          behavior: 'smooth',
          block: 'nearest',
          inline: 'center'
        });
      }

      thumbs.forEach(function (thumb, i) {
        if (i === currentIndex) {
          thumb.classList.add('image-viewer-thumb--active');
        } else {
          thumb.classList.remove('image-viewer-thumb--active');
        }
      });
    }

    if (prevButton) {
      prevButton.addEventListener('click', function () {
        setActive(currentIndex - 1);
      });
    }

    if (nextButton) {
      nextButton.addEventListener('click', function () {
        setActive(currentIndex + 1);
      });
    }

    thumbs.forEach(function (thumb) {
      thumb.addEventListener('click', function () {
        var index = parseInt(thumb.getAttribute('data-index'), 10);
        if (!isNaN(index)) {
          setActive(index);
        }
      });
    });

    // Ensure the first slide is active on load
    setActive(0);
  })();
</script>
{% endif %}
